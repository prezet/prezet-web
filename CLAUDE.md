# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Laravel 11 application that serves as the documentation website for Prezet, a markdown blogging package for Laravel. The site uses the Prezet package itself to render markdown documentation with syntax highlighting, SEO optimization, and full-text search capabilities.

## Essential Commands

### Development
```bash
# Start development server
php artisan serve

# Install dependencies
composer install
npm install

# Build frontend assets
npm run dev        # Development with hot reload
npm run build      # Production build
```

### Testing
```bash
# Run all tests
php artisan test

# Run PHPUnit directly
vendor/bin/phpunit

# Code formatting
vendor/bin/pint
```

### Prezet-Specific Commands
```bash
# Rebuild the search index from markdown files
php artisan prezet:index

# Rebuild index from scratch (drops and recreates database)
php artisan prezet:index --fresh

# Generate OG images for documentation pages
php artisan prezet:ogimage

# Purge Cloudflare cache
php artisan prezet:purge
```

## Architecture

### Content Management

**Markdown Storage**: All documentation content lives in `prezet/content/` (at project root) as markdown files. These files include YAML frontmatter with metadata (title, excerpt, category, date, image, author).

**Search Index**: Prezet maintains a SQLite database (`prezet.sqlite`) that indexes all markdown content for full-text search. This is automatically updated via `prezet:index` command.

**Summary Files**: Navigation structure is defined in `prezet/SUMMARY.md` (current docs) and `prezet/SUMMARYv0.md` (legacy docs). These files use markdown lists to define the documentation hierarchy.

### Custom Prezet Extensions

This project extends Prezet's base functionality through Laravel's service container bindings in `AppServiceProvider`:

1. **CustomFrontmatterData** (`app/Data/CustomFrontmatterData.php`): Extends base frontmatter to add a `legacy` boolean field for marking older documentation.

2. **CustomUpdateIndex** (`app/Actions/CustomUpdateIndex.php`): Overrides heading extraction to skip headings for legacy documents (when `legacy: true` in frontmatter).

3. **CustomGetSummary** (`app/Actions/CustomGetSummary.php`): Routes requests to v0.x documentation paths to use `SUMMARYv0.md` instead of the default `SUMMARY.md`.

### Routing

Routes are defined in two files:
- `routes/web.php`: Includes feeds and delegates to prezet routes
- `routes/prezet.php`: Defines all Prezet routes (index, show, search, images, ogimages)

All Prezet routes bypass CSRF protection and session middleware, with aggressive caching headers (30 days, immutable).

### Controllers

Custom controllers in `app/Http/Controllers/`:
- `IndexController`: Homepage/documentation index
- `ShowController`: Individual documentation pages
- `SearchController`: Full-text search endpoint
- `ImageController`: Responsive image delivery
- `OgimageController`: Dynamic Open Graph image generation

### Markdown Processing

Prezet uses League CommonMark with several extensions (configured in `config/prezet.php`):
- **CommonMarkCoreExtension**: Base markdown parsing
- **HeadingPermalinkExtension**: Adds anchor links to headings
- **ExternalLinkExtension**: Adds target="_blank" and nofollow to external links
- **FrontMatterExtension**: YAML frontmatter parsing
- **MarkdownBladeExtension**: Custom Blade component rendering in markdown
- **MarkdownImageExtension**: Responsive image processing
- **PhikiExtension**: Syntax highlighting (Material theme)

Images are automatically resized to multiple widths (480, 640, 768, 960, 1536) for responsive delivery.

### SEO & Structured Data

SEO configuration in `AppServiceProvider::boot()` sets default meta tags. Authors and publisher information for JSON-LD structured data are defined in `config/prezet.php`.

### RSS Feed

The site provides an Atom feed at `/feed` using `spatie/laravel-feed`. Feed items are generated by `RssDocument::getAllFeedItems()` (see `app/Models/RssDocument.php`).

## Key Configuration Files

- `config/prezet.php`: All Prezet configuration (markdown extensions, image settings, SEO, structured data)
- `config/filesystems.php`: Defines `prezet` disk pointing to `storage/prezet`
- `config/feed.php`: RSS/Atom feed configuration
- `tailwind.prezet.config.js`: Tailwind configuration specific to Prezet styling

## Development Notes

- The `prezet` filesystem disk points to `prezet/` directory at the project root but can be configured for S3/cloud storage
- Views can be customized by publishing Prezet views: they're currently published to `resources/views/vendor/prezet/`
- Custom Blade components in `resources/views/components/` (alert, version-select)
- The project uses forked versions of some packages (see `repositories` in composer.json): `torchlight-commonmark-php` and `laravel-seo`
- After modifying markdown content in `prezet/content/`, run `php artisan prezet:index` to update the search index
